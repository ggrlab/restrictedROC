<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Paper 06: rROC scaling/recalculating â€¢ restrictedROC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Paper 06: rROC scaling/recalculating">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">restrictedROC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.3.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examples_01_AUROC_TESTS.html">AUROC, Mann-Whitney U and Wilcoxon rank-sum</a></li>
    <li><a class="dropdown-item" href="../articles/paper_01_roccurves.html">Paper 01: ROC curves</a></li>
    <li><a class="dropdown-item" href="../articles/paper_02_rROC_theoretic.html">Paper 02: rROC theoretic</a></li>
    <li><a class="dropdown-item" href="../articles/paper_03_rROC_partROCs.html">Paper 03: rROC partROCs</a></li>
    <li><a class="dropdown-item" href="../articles/paper_04_rROC_theoretic_FPR.html">Paper 04: rROC theoretic with FPR</a></li>
    <li><a class="dropdown-item" href="../articles/paper_05_varying_mean_variance.html">Paper 05: rROC with varying mean/variance</a></li>
    <li><a class="dropdown-item" href="../articles/paper_06_rROC_scaling_vs_recalculate.html">Paper 06: rROC scaling/recalculating</a></li>
    <li><a class="dropdown-item" href="../articles/paper_07_rROC_twoway.html">Paper 07: rROC label swap</a></li>
    <li><a class="dropdown-item" href="../articles/paper_08_rROC_permutation_bias.html">Paper 08: rROC permutation</a></li>
    <li><a class="dropdown-item" href="../articles/paper_09_cartoon_fig2.html">Paper 09: rROC concept</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_01_rzAUC_colors.html">Vignette 01: rzAUC colors</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_02_restriction_plots.html">Vignette 02: Restriction plots</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Paper 06: rROC scaling/recalculating</h1>
            
      

      <div class="d-none name"><code>paper_06_rROC_scaling_vs_recalculate.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrlab.github.io/restrictedROC/">restrictedROC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"res/paper"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in dir.create("res/paper", recursive = TRUE): 'res/paper' already</span></span>
<span><span class="co">#&gt; exists</span></span>
<span><span class="va">main_plotname</span> <span class="op">&lt;-</span> <span class="st">"res/paper/proc_rroc_"</span></span></code></pre></div>
<div class="section level2">
<h2 id="scaling-and-recalculating-leads-to-the-same-rauc-shown-visually">Scaling and recalculating leads to the same rAUC, shown
visually<a class="anchor" aria-label="anchor" href="#scaling-and-recalculating-leads-to-the-same-rauc-shown-visually"></a>
</h2>
<p>Applying our scaling factor to the partial AUC from the complete ROC
curve is exactly the same as recalculating the AUC on the respective
part of the values. If you have <code>ImageMagick</code> installed you
can recreate the GIF we presented in our publication</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">current_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dists</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">restrictedROC</span><span class="fu">::</span><span class="fu"><a href="../reference/sim.html">sim</a></span><span class="op">(</span><span class="va">dists</span>, do_melt <span class="op">=</span> <span class="cn">FALSE</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">129387</span><span class="op">)</span></span>
<span><span class="va">simdata</span> <span class="op">&lt;-</span> <span class="fu">current_sim</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Positive"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">length.out</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">unif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">length.out</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">unif</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">9</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        <span class="st">"Negative"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">length.out</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">unif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">length.out</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">unif</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">.02</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">9</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdata_melted</span> <span class="op">&lt;-</span> <span class="fu">restrictedROC</span><span class="fu">::</span><span class="fu"><a href="../reference/melt_gendata.html">melt_gendata</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">simdata_melted</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"predictions"</span>, <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">simdata_melted</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">simdata_melted</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"Positive"</span><span class="op">)</span></span>
<span><span class="va">simple_df</span> <span class="op">&lt;-</span> <span class="va">simdata_melted</span></span>
<span><span class="va">rroc</span> <span class="op">&lt;-</span> <span class="fu">restrictedROC</span><span class="fu">::</span><span class="fu"><a href="../reference/rROC.html">rROC</a></span><span class="op">(</span></span>
<span>    <span class="va">simple_df</span>,</span>
<span>    positive_label <span class="op">=</span> <span class="st">"Positive"</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"&lt;"</span>,</span>
<span>    return_proc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    independent_vars <span class="op">=</span> <span class="st">"predictions"</span>,</span>
<span>    dependent_vars <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>    n_permutations <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span><span class="op">[[</span><span class="st">"response"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"predictions"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"permutation"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; Thu Jan 30 20:30:16 2025      response predictions ( 1 )</span></span>
<span></span>
<span><span class="va">include_part_auc_text</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">plot_scale</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span></span>
<span><span class="va">roc_data_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">"original.predictor"</span> <span class="op">=</span> <span class="va">rroc</span><span class="op">[[</span><span class="st">"pROC_full"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"original.predictor"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="st">"original.response"</span> <span class="op">=</span> <span class="va">rroc</span><span class="op">[[</span><span class="st">"pROC_full"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"original.response"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">splitted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">roc_data_df</span><span class="op">[[</span><span class="st">"original.predictor"</span><span class="op">]</span><span class="op">]</span>, <span class="va">roc_data_df</span><span class="op">[[</span><span class="st">"original.response"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">splitted_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Negative"</span>, <span class="st">"Positive"</span><span class="op">)</span></span>
<span><span class="va">p_full_density_ROC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_density_ROC_empirical.html">plot_density_ROC_empirical</a></span><span class="op">(</span></span>
<span>    values_grouped <span class="op">=</span> <span class="va">splitted_data</span>,</span>
<span>    length.out <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    xmin <span class="op">=</span> <span class="fl">3</span>, xmax <span class="op">=</span> <span class="fl">11</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"&lt;"</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Negative"</span>, <span class="st">"Positive"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># pdf(paste0(main_plotname, "p07_rroc_proc_scaling.pdf"), width = 8 * plot_scale, height = 4 * plot_scale)</span></span>
<span><span class="co"># for (threshold_x in rroc$pROC_full$thresholds[5:185]) {  # all valid values</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">threshold_x</span> <span class="kw">in</span> <span class="va">rroc</span><span class="op">$</span><span class="va">pROC_full</span><span class="op">$</span><span class="va">thresholds</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">185</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">125</span>, <span class="fl">150</span>, <span class="fl">175</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p_rroc_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_rROC_part.html">plot_rROC_part</a></span><span class="op">(</span></span>
<span>        <span class="va">rroc</span>,</span>
<span>        p_full_density_ROC <span class="op">=</span> <span class="va">p_full_density_ROC</span>,</span>
<span>        threshold <span class="op">=</span> <span class="va">threshold_x</span>,</span>
<span>        include_part_auc_text <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_rroc_part</span><span class="op">$</span><span class="va">patchworked</span> <span class="op">+</span> <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-1.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-2.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-3.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-4.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-5.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-6.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-7.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-8.png" width="480"><img src="paper_06_rROC_scaling_vs_recalculate_files/figure-html/unnamed-chunk-2-9.png" width="480"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dev.off()</span></span>
<span></span>
<span></span>
<span><span class="co"># The following can only be done if imagemagick is installed</span></span>
<span><span class="co"># # apt install ImageMagick</span></span>
<span><span class="co"># command &lt;- paste0("convert -verbose -delay 15 -loop 0 -density 100 ", paste0(main_plotname, "p07_rroc_proc_scaling.pdf"), " ", paste0(main_plotname, "p07_rroc_proc_scaling.gif"))</span></span>
<span><span class="co"># system(command)</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gunther Glehr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
